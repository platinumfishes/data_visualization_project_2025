<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Query Government Census API for US Census Broadband Data (ACS 5 year estimate, 2022) – Broadband Internet Access in the US</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Broadband Internet Access in the US</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../background.html"> 
<span class="menu-text">Background</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../data.html"> 
<span class="menu-text">Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../insights.html"> 
<span class="menu-text">Insights</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Query Government Census API for US Census Broadband Data (ACS 5 year estimate, 2022)</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="cell-2" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Output path (change if needed)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> Path(<span class="st">"../data/census_broadband.csv"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>output_path.parent.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Census variables to query</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>variables <span class="op">=</span> [</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NAME"</span>,              <span class="co"># County name</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B28002_001E"</span>,       <span class="co"># Total households</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B28002_004E"</span>,       <span class="co"># HH with broadband</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B28002_013E"</span>,       <span class="co"># HH with no internet</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B28003_001E"</span>,       <span class="co"># HH with computer</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B28003_004E"</span>,       <span class="co"># HH with computer and broadband</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B01003_001E"</span>,       <span class="co"># Total population</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B19013_001E"</span>        <span class="co"># Median household income</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapping from FIPS to state abbreviations</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>fips_to_state <span class="op">=</span> {</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"01"</span>: <span class="st">"AL"</span>, <span class="st">"02"</span>: <span class="st">"AK"</span>, <span class="st">"04"</span>: <span class="st">"AZ"</span>, <span class="st">"05"</span>: <span class="st">"AR"</span>, <span class="st">"06"</span>: <span class="st">"CA"</span>, <span class="st">"08"</span>: <span class="st">"CO"</span>,</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"09"</span>: <span class="st">"CT"</span>, <span class="st">"10"</span>: <span class="st">"DE"</span>, <span class="st">"11"</span>: <span class="st">"DC"</span>, <span class="st">"12"</span>: <span class="st">"FL"</span>, <span class="st">"13"</span>: <span class="st">"GA"</span>, <span class="st">"15"</span>: <span class="st">"HI"</span>,</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"16"</span>: <span class="st">"ID"</span>, <span class="st">"17"</span>: <span class="st">"IL"</span>, <span class="st">"18"</span>: <span class="st">"IN"</span>, <span class="st">"19"</span>: <span class="st">"IA"</span>, <span class="st">"20"</span>: <span class="st">"KS"</span>, <span class="st">"21"</span>: <span class="st">"KY"</span>,</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"22"</span>: <span class="st">"LA"</span>, <span class="st">"23"</span>: <span class="st">"ME"</span>, <span class="st">"24"</span>: <span class="st">"MD"</span>, <span class="st">"25"</span>: <span class="st">"MA"</span>, <span class="st">"26"</span>: <span class="st">"MI"</span>, <span class="st">"27"</span>: <span class="st">"MN"</span>,</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"28"</span>: <span class="st">"MS"</span>, <span class="st">"29"</span>: <span class="st">"MO"</span>, <span class="st">"30"</span>: <span class="st">"MT"</span>, <span class="st">"31"</span>: <span class="st">"NE"</span>, <span class="st">"32"</span>: <span class="st">"NV"</span>, <span class="st">"33"</span>: <span class="st">"NH"</span>,</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"34"</span>: <span class="st">"NJ"</span>, <span class="st">"35"</span>: <span class="st">"NM"</span>, <span class="st">"36"</span>: <span class="st">"NY"</span>, <span class="st">"37"</span>: <span class="st">"NC"</span>, <span class="st">"38"</span>: <span class="st">"ND"</span>, <span class="st">"39"</span>: <span class="st">"OH"</span>,</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"40"</span>: <span class="st">"OK"</span>, <span class="st">"41"</span>: <span class="st">"OR"</span>, <span class="st">"42"</span>: <span class="st">"PA"</span>, <span class="st">"44"</span>: <span class="st">"RI"</span>, <span class="st">"45"</span>: <span class="st">"SC"</span>, <span class="st">"46"</span>: <span class="st">"SD"</span>,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"47"</span>: <span class="st">"TN"</span>, <span class="st">"48"</span>: <span class="st">"TX"</span>, <span class="st">"49"</span>: <span class="st">"UT"</span>, <span class="st">"50"</span>: <span class="st">"VT"</span>, <span class="st">"51"</span>: <span class="st">"VA"</span>, <span class="st">"53"</span>: <span class="st">"WA"</span>,</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"54"</span>: <span class="st">"WV"</span>, <span class="st">"55"</span>: <span class="st">"WI"</span>, <span class="st">"56"</span>: <span class="st">"WY"</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Base URL for ACS 5-Year 2022</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>base_url <span class="op">=</span> <span class="st">"https://api.census.gov/data/2022/acs/acs5"</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># All valid state FIPS codes (01–56, excluding deprecated)</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>state_fips <span class="op">=</span> [</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"</span><span class="sc">{</span>i<span class="sc">:02d}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">57</span>)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="kw">not</span> <span class="kw">in</span> {<span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">14</span>, <span class="dv">43</span>, <span class="dv">52</span>}</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Start fetching</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>all_data <span class="op">=</span> []</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"📡 Starting data fetch from Census API..."</span>)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> fips <span class="kw">in</span> state_fips:</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"🔍 Querying counties in state FIPS </span><span class="sc">{</span>fips<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>fips_to_state<span class="sc">.</span>get(fips, <span class="st">'Unknown'</span>)<span class="sc">}</span><span class="ss">)..."</span>)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">"get"</span>: <span class="st">","</span>.join(variables),</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">"for"</span>: <span class="st">"county:*"</span>,</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        <span class="st">"in"</span>: <span class="ss">f"state:</span><span class="sc">{</span>fips<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(base_url, params<span class="op">=</span>params)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> response.json()</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>        columns <span class="op">=</span> data[<span class="dv">0</span>]</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        rows <span class="op">=</span> data[<span class="dv">1</span>:]</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.DataFrame(rows, columns<span class="op">=</span>columns)</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"state_abbr"</span>] <span class="op">=</span> fips_to_state.get(fips, <span class="st">"Unknown"</span>)</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>        all_data.append(df)</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Retrieved </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">}</span><span class="ss"> records."</span>)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Failed for state </span><span class="sc">{</span>fips<span class="sc">}</span><span class="ss">: status code </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.5</span>)  <span class="co"># throttle requests</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine and save</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>final_df <span class="op">=</span> pd.concat(all_data, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>final_df.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Data saved to: </span><span class="sc">{</span>output_path<span class="sc">.</span>resolve()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>📡 Starting data fetch from Census API...
🔍 Querying counties in state FIPS 01 (AL)...
  ✅ Retrieved 67 records.
🔍 Querying counties in state FIPS 02 (AK)...
  ✅ Retrieved 30 records.
🔍 Querying counties in state FIPS 04 (AZ)...
  ✅ Retrieved 15 records.
🔍 Querying counties in state FIPS 05 (AR)...
  ✅ Retrieved 75 records.
🔍 Querying counties in state FIPS 06 (CA)...
  ✅ Retrieved 58 records.
🔍 Querying counties in state FIPS 08 (CO)...
  ✅ Retrieved 64 records.
🔍 Querying counties in state FIPS 09 (CT)...
  ✅ Retrieved 9 records.
🔍 Querying counties in state FIPS 10 (DE)...
  ✅ Retrieved 3 records.
🔍 Querying counties in state FIPS 11 (DC)...
  ✅ Retrieved 1 records.
🔍 Querying counties in state FIPS 12 (FL)...
  ✅ Retrieved 67 records.
🔍 Querying counties in state FIPS 13 (GA)...
  ✅ Retrieved 159 records.
🔍 Querying counties in state FIPS 15 (HI)...
  ✅ Retrieved 5 records.
🔍 Querying counties in state FIPS 16 (ID)...
  ✅ Retrieved 44 records.
🔍 Querying counties in state FIPS 17 (IL)...
  ✅ Retrieved 102 records.
🔍 Querying counties in state FIPS 18 (IN)...
  ✅ Retrieved 92 records.
🔍 Querying counties in state FIPS 19 (IA)...
  ✅ Retrieved 99 records.
🔍 Querying counties in state FIPS 20 (KS)...
  ✅ Retrieved 105 records.
🔍 Querying counties in state FIPS 21 (KY)...
  ✅ Retrieved 120 records.
🔍 Querying counties in state FIPS 22 (LA)...
  ✅ Retrieved 64 records.
🔍 Querying counties in state FIPS 23 (ME)...
  ✅ Retrieved 16 records.
🔍 Querying counties in state FIPS 24 (MD)...
  ✅ Retrieved 24 records.
🔍 Querying counties in state FIPS 25 (MA)...
  ✅ Retrieved 14 records.
🔍 Querying counties in state FIPS 26 (MI)...
  ✅ Retrieved 83 records.
🔍 Querying counties in state FIPS 27 (MN)...
  ✅ Retrieved 87 records.
🔍 Querying counties in state FIPS 28 (MS)...
  ✅ Retrieved 82 records.
🔍 Querying counties in state FIPS 29 (MO)...
  ✅ Retrieved 115 records.
🔍 Querying counties in state FIPS 30 (MT)...
  ✅ Retrieved 56 records.
🔍 Querying counties in state FIPS 31 (NE)...
  ✅ Retrieved 93 records.
🔍 Querying counties in state FIPS 32 (NV)...
  ✅ Retrieved 17 records.
🔍 Querying counties in state FIPS 33 (NH)...
  ✅ Retrieved 10 records.
🔍 Querying counties in state FIPS 34 (NJ)...
  ✅ Retrieved 21 records.
🔍 Querying counties in state FIPS 35 (NM)...
  ✅ Retrieved 33 records.
🔍 Querying counties in state FIPS 36 (NY)...
  ✅ Retrieved 62 records.
🔍 Querying counties in state FIPS 37 (NC)...
  ✅ Retrieved 100 records.
🔍 Querying counties in state FIPS 38 (ND)...
  ✅ Retrieved 53 records.
🔍 Querying counties in state FIPS 39 (OH)...
  ✅ Retrieved 88 records.
🔍 Querying counties in state FIPS 40 (OK)...
  ✅ Retrieved 77 records.
🔍 Querying counties in state FIPS 41 (OR)...
  ✅ Retrieved 36 records.
🔍 Querying counties in state FIPS 42 (PA)...
  ✅ Retrieved 67 records.
🔍 Querying counties in state FIPS 44 (RI)...
  ✅ Retrieved 5 records.
🔍 Querying counties in state FIPS 45 (SC)...
  ✅ Retrieved 46 records.
🔍 Querying counties in state FIPS 46 (SD)...
  ✅ Retrieved 66 records.
🔍 Querying counties in state FIPS 47 (TN)...
  ✅ Retrieved 95 records.
🔍 Querying counties in state FIPS 48 (TX)...
  ✅ Retrieved 254 records.
🔍 Querying counties in state FIPS 49 (UT)...
  ✅ Retrieved 29 records.
🔍 Querying counties in state FIPS 50 (VT)...
  ✅ Retrieved 14 records.
🔍 Querying counties in state FIPS 51 (VA)...
  ✅ Retrieved 133 records.
🔍 Querying counties in state FIPS 53 (WA)...
  ✅ Retrieved 39 records.
🔍 Querying counties in state FIPS 54 (WV)...
  ✅ Retrieved 55 records.
🔍 Querying counties in state FIPS 55 (WI)...
  ✅ Retrieved 72 records.
🔍 Querying counties in state FIPS 56 (WY)...
  ✅ Retrieved 23 records.
✅ Data saved to: /home/platinumfish/Desktop/Coding_projects/data_visualization_project_2025/code/data/census_broadband.csv</code></pre>
</div>
</div>
<section id="change-variable-names-after-data-retrieval" class="level3">
<h3 class="anchored" data-anchor-id="change-variable-names-after-data-retrieval">Change Variable Names After Data Retrieval</h3>
<div id="cell-4" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"../data/census_broadband.csv"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.rename(columns<span class="op">=</span>{</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NAME"</span>: <span class="st">"county_name"</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B28002_001E"</span>: <span class="st">"total_households"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B28002_004E"</span>: <span class="st">"households_with_broadband"</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B28002_013E"</span>: <span class="st">"households_with_no_internet"</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B28003_001E"</span>: <span class="st">"households_with_computer"</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B28003_004E"</span>: <span class="st">"households_with_computer_and_broadband"</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B01003_001E"</span>: <span class="st">"total_population"</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B19013_001E"</span>: <span class="st">"median_household_income"</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"state"</span>: <span class="st">"state_fips"</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"county"</span>: <span class="st">"county_fips"</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Save cleaned version (optional)</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">"../data/census_broadband_cleaned.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               county_name  total_households  households_with_broadband  \
0  Autauga County, Alabama             22308                      19869   
1  Baldwin County, Alabama             90802                      80742   
2  Barbour County, Alabama              9016                       6151   
3     Bibb County, Alabama              7216                       5752   
4   Blount County, Alabama             21626                      17890   

   households_with_no_internet  households_with_computer  \
0                         2111                     22308   
1                         8127                     90802   
2                         2194                      9016   
3                         1391                      7216   
4                         3243                     21626   

   households_with_computer_and_broadband  total_population  \
0                                   19744             58761   
1                                   80169            233420   
2                                    6093             24877   
3                                    5666             22251   
4                                   17625             59077   

   median_household_income  state_fips  county_fips state_abbr  
0                    68315           1            1         AL  
1                    71039           1            3         AL  
2                    39712           1            5         AL  
3                    50669           1            7         AL  
4                    57440           1            9         AL  </code></pre>
</div>
</div>
</section>
<section id="clean-our-data-files-gathered-from-httpswww.fcc.govform-477-county-data-internet-access-services" class="level3">
<h3 class="anchored" data-anchor-id="clean-our-data-files-gathered-from-httpswww.fcc.govform-477-county-data-internet-access-services">Clean Our Data Files gathered from [https://www.fcc.gov/form-477-county-data-internet-access-services]</h3>
<div id="cell-6" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load ACS broadband data</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>acs_path <span class="op">=</span> Path(<span class="st">"../data/census_broadband_cleaned.csv"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>acs_df <span class="op">=</span> pd.read_csv(acs_path, dtype<span class="op">=</span>{<span class="st">"state_fips"</span>: <span class="bu">str</span>, <span class="st">"county_fips"</span>: <span class="bu">str</span>})</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Load FCC tier data (decode using ISO-8859-1 due to special characters)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>fcc_path <span class="op">=</span> Path(<span class="st">"../data/county_tiers_201406_202312.csv"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>fcc_df <span class="op">=</span> pd.read_csv(fcc_path, encoding<span class="op">=</span><span class="st">"ISO-8859-1"</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter FCC data to December 2023</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>fcc_df <span class="op">=</span> fcc_df[(fcc_df[<span class="st">"Year"</span>] <span class="op">==</span> <span class="dv">2023</span>) <span class="op">&amp;</span> (fcc_df[<span class="st">"Month"</span>] <span class="op">==</span> <span class="dv">12</span>)]</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename FCC columns for clarity</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>fcc_df <span class="op">=</span> fcc_df.rename(columns<span class="op">=</span>{</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"FIPS"</span>: <span class="st">"fips_code"</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Housing_Units"</span>: <span class="st">"housing_units"</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Tier_1"</span>: <span class="st">"connections_200kbps_per_1000"</span>,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Tier_2"</span>: <span class="st">"connections_10mbps_per_1000"</span>,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Tier_3"</span>: <span class="st">"connections_25mbps_per_1000"</span>,</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Tier_4"</span>: <span class="st">"connections_100mbps_per_1000"</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Pad FIPS codes</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>fcc_df[<span class="st">"fips_code"</span>] <span class="op">=</span> fcc_df[<span class="st">"fips_code"</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.zfill(<span class="dv">5</span>)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>acs_df[<span class="st">"fips_code"</span>] <span class="op">=</span> acs_df[<span class="st">"state_fips"</span>].<span class="bu">str</span>.zfill(<span class="dv">2</span>) <span class="op">+</span> acs_df[<span class="st">"county_fips"</span>].<span class="bu">str</span>.zfill(<span class="dv">3</span>)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge ACS and FCC data on fips_code</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.merge(acs_df, fcc_df, on<span class="op">=</span><span class="st">"fips_code"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Save merged dataset</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> Path(<span class="st">"../data/merged_broadband_data.csv"</span>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>merged_df.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Merged dataset saved to: </span><span class="sc">{</span>output_path<span class="sc">.</span>resolve()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final dataset shape: </span><span class="sc">{</span>merged_df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Merged dataset saved to: /home/platinumfish/Desktop/Coding_projects/data_visualization_project_2025/data/merged_broadband_data.csv
Final dataset shape: (3144, 23)</code></pre>
</div>
</div>
</section>
<section id="merge-both-and" class="level3">
<h3 class="anchored" data-anchor-id="merge-both-and">Merge both @ and @</h3>
<div id="cell-8" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># === Load ACS Data ===</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>acs_path <span class="op">=</span> Path(<span class="st">"../data/census_broadband_cleaned.csv"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>acs_df <span class="op">=</span> pd.read_csv(acs_path, dtype<span class="op">=</span>{<span class="st">"state_fips"</span>: <span class="bu">str</span>, <span class="st">"county_fips"</span>: <span class="bu">str</span>})</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>acs_df[<span class="st">"fips_code"</span>] <span class="op">=</span> acs_df[<span class="st">"state_fips"</span>].<span class="bu">str</span>.zfill(<span class="dv">2</span>) <span class="op">+</span> acs_df[<span class="st">"county_fips"</span>].<span class="bu">str</span>.zfill(<span class="dv">3</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># === Load FCC Connections Data ===</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>fcc_path <span class="op">=</span> Path(<span class="st">"../data/county_connections_200906_202312.csv"</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>fcc_df <span class="op">=</span> pd.read_csv(fcc_path, encoding<span class="op">=</span><span class="st">"ISO-8859-1"</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to December 2023</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>fcc_df <span class="op">=</span> fcc_df[(fcc_df[<span class="st">"year"</span>] <span class="op">==</span> <span class="dv">2023</span>) <span class="op">&amp;</span> (fcc_df[<span class="st">"month"</span>] <span class="op">==</span> <span class="dv">12</span>)]</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>fcc_df <span class="op">=</span> fcc_df.rename(columns<span class="op">=</span>{</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"countycode"</span>: <span class="st">"fips_code"</span>,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"statename"</span>: <span class="st">"state_name"</span>,</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"countyname"</span>: <span class="st">"county_name"</span>,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"consumer"</span>: <span class="st">"residential_connections_k"</span>,</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"non_consumer"</span>: <span class="st">"nonresidential_connections_k"</span>,</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"all"</span>: <span class="st">"total_connections_k"</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Pad FIPS to 5 digits</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>fcc_df[<span class="st">"fips_code"</span>] <span class="op">=</span> fcc_df[<span class="st">"fips_code"</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.zfill(<span class="dv">5</span>)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co"># === Merge on fips_code ===</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.merge(acs_df, fcc_df, on<span class="op">=</span><span class="st">"fips_code"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co"># === Save output ===</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> Path(<span class="st">"../data/merged_broadband_connections.csv"</span>)</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>merged_df.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Merged dataset saved to: </span><span class="sc">{</span>output_path<span class="sc">.</span>resolve()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final shape: </span><span class="sc">{</span>merged_df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Merged dataset saved to: /home/platinumfish/Desktop/Coding_projects/data_visualization_project_2025/data/merged_broadband_connections.csv
Final shape: (3144, 19)</code></pre>
</div>
</div>
</section>
<section id="combine-the-data-to-create-a-comprehensive-dataset" class="level3">
<h3 class="anchored" data-anchor-id="combine-the-data-to-create-a-comprehensive-dataset">Combine the @ Data to create a Comprehensive Dataset</h3>
<div id="cell-10" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># === Load ACS Data ===</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>acs_path <span class="op">=</span> Path(<span class="st">"../data/census_broadband_cleaned.csv"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>acs_df <span class="op">=</span> pd.read_csv(acs_path, dtype<span class="op">=</span>{<span class="st">"state_fips"</span>: <span class="bu">str</span>, <span class="st">"county_fips"</span>: <span class="bu">str</span>})</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>acs_df[<span class="st">"fips_code"</span>] <span class="op">=</span> acs_df[<span class="st">"state_fips"</span>].<span class="bu">str</span>.zfill(<span class="dv">2</span>) <span class="op">+</span> acs_df[<span class="st">"county_fips"</span>].<span class="bu">str</span>.zfill(<span class="dv">3</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># === Load FCC Tier Data ===</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>tier_path <span class="op">=</span> Path(<span class="st">"../data/county_tiers_201406_202312.csv"</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>tier_df <span class="op">=</span> pd.read_csv(tier_path, encoding<span class="op">=</span><span class="st">"ISO-8859-1"</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>tier_df <span class="op">=</span> tier_df[(tier_df[<span class="st">"Year"</span>] <span class="op">==</span> <span class="dv">2023</span>) <span class="op">&amp;</span> (tier_df[<span class="st">"Month"</span>] <span class="op">==</span> <span class="dv">12</span>)]</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>tier_df <span class="op">=</span> tier_df.rename(columns<span class="op">=</span>{</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"FIPS"</span>: <span class="st">"fips_code"</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Housing_Units"</span>: <span class="st">"housing_units"</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Tier_1"</span>: <span class="st">"connections_200kbps_per_1000"</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Tier_2"</span>: <span class="st">"connections_10mbps_per_1000"</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Tier_3"</span>: <span class="st">"connections_25mbps_per_1000"</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Tier_4"</span>: <span class="st">"connections_100mbps_per_1000"</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>tier_df[<span class="st">"fips_code"</span>] <span class="op">=</span> tier_df[<span class="st">"fips_code"</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.zfill(<span class="dv">5</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># === Load FCC Connection Volume Data ===</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>conn_path <span class="op">=</span> Path(<span class="st">"../data/county_connections_200906_202312.csv"</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>conn_df <span class="op">=</span> pd.read_csv(conn_path, encoding<span class="op">=</span><span class="st">"ISO-8859-1"</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>conn_df <span class="op">=</span> conn_df[(conn_df[<span class="st">"year"</span>] <span class="op">==</span> <span class="dv">2023</span>) <span class="op">&amp;</span> (conn_df[<span class="st">"month"</span>] <span class="op">==</span> <span class="dv">12</span>)]</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>conn_df <span class="op">=</span> conn_df.rename(columns<span class="op">=</span>{</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"countycode"</span>: <span class="st">"fips_code"</span>,</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"statename"</span>: <span class="st">"state_name"</span>,</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"countyname"</span>: <span class="st">"county_name"</span>,</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"consumer"</span>: <span class="st">"residential_connections_k"</span>,</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"non_consumer"</span>: <span class="st">"nonresidential_connections_k"</span>,</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"all"</span>: <span class="st">"total_connections_k"</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>conn_df[<span class="st">"fips_code"</span>] <span class="op">=</span> conn_df[<span class="st">"fips_code"</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.zfill(<span class="dv">5</span>)</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="co"># === Merge all datasets ===</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>merged <span class="op">=</span> pd.merge(acs_df, tier_df, on<span class="op">=</span><span class="st">"fips_code"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>merged <span class="op">=</span> pd.merge(merged, conn_df[[</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fips_code"</span>, <span class="st">"year"</span>, <span class="st">"month"</span>,</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"residential_connections_k"</span>, <span class="st">"nonresidential_connections_k"</span>, <span class="st">"total_connections_k"</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>]], on<span class="op">=</span><span class="st">"fips_code"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="co"># === Reorder columns ===</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>column_order <span class="op">=</span> [</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Location + time</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fips_code"</span>, <span class="st">"state_fips"</span>, <span class="st">"county_fips"</span>, <span class="st">"state_abbr"</span>, <span class="st">"county_name"</span>, <span class="st">"year"</span>, <span class="st">"month"</span>,</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Demographics</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">"total_population"</span>, <span class="st">"median_household_income"</span>,</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ACS: access + devices</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">"total_households"</span>, <span class="st">"households_with_computer"</span>, <span class="st">"households_with_computer_and_broadband"</span>,</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">"households_with_broadband"</span>, <span class="st">"households_with_no_internet"</span>,</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># FCC: availability per 1,000 units</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>    <span class="st">"housing_units"</span>,</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    <span class="st">"connections_200kbps_per_1000"</span>, <span class="st">"connections_10mbps_per_1000"</span>,</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">"connections_25mbps_per_1000"</span>, <span class="st">"connections_100mbps_per_1000"</span>,</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># FCC: actual connections (volume)</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">"residential_connections_k"</span>, <span class="st">"nonresidential_connections_k"</span>, <span class="st">"total_connections_k"</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only columns that exist in the merged dataframe</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>final_columns <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> column_order <span class="cf">if</span> col <span class="kw">in</span> merged.columns]</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>merged <span class="op">=</span> merged[final_columns]</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a><span class="co"># === Save final dataset ===</span></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> Path(<span class="st">"../data/merged_broadband_full.csv"</span>)</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>merged.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Merged dataset saved to: </span><span class="sc">{</span>output_path<span class="sc">.</span>resolve()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final shape: </span><span class="sc">{</span>merged<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Merged dataset saved to: /home/platinumfish/Desktop/Coding_projects/data_visualization_project_2025/data/merged_broadband_full.csv
Final shape: (3144, 22)</code></pre>
</div>
</div>
</section>
<section id="create-additional-variables-based-on-actual-broadband-usage" class="level3">
<h3 class="anchored" data-anchor-id="create-additional-variables-based-on-actual-broadband-usage">Create Additional Variables Based on Actual Broadband Usage</h3>
<div id="cell-12" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the merged dataset</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.read_csv(<span class="st">"../data/merged_broadband_full.csv"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate broadband access rate</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>merged_df[<span class="st">"broadband_access_rate"</span>] <span class="op">=</span> (</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    merged_df[<span class="st">"households_with_broadband"</span>] <span class="op">/</span> merged_df[<span class="st">"total_households"</span>]</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate residential connections per household</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>merged_df[<span class="st">"res_conn_per_household"</span>] <span class="op">=</span> (</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    merged_df[<span class="st">"residential_connections_k"</span>] <span class="op">*</span> <span class="dv">1000</span> <span class="op">/</span> merged_df[<span class="st">"total_households"</span>]</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Save updated dataset</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> Path(<span class="st">"../data/merged_broadband_full.csv"</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>merged_df.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Merged dataset saved to: </span><span class="sc">{</span>output_path<span class="sc">.</span>resolve()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Merged dataset saved to: /home/platinumfish/Desktop/Coding_projects/data_visualization_project_2025/data/merged_broadband_full.csv</code></pre>
</div>
</div>
<div id="cell-13" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Clear memory from previous runs ===</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>all_data <span class="op">=</span> []</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>edu_df <span class="op">=</span> <span class="va">None</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># === File paths ===</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>acs_path <span class="op">=</span> Path(<span class="st">"../data/merged_broadband_full.csv"</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>edu_output_path <span class="op">=</span> Path(<span class="st">"../data/merged_broadband_full.csv"</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># === Load existing dataset ===</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>df_main <span class="op">=</span> pd.read_csv(acs_path, dtype<span class="op">=</span>{<span class="st">"state_fips"</span>: <span class="bu">str</span>, <span class="st">"county_fips"</span>: <span class="bu">str</span>})</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>df_main[<span class="st">"fips_code"</span>] <span class="op">=</span> df_main[<span class="st">"state_fips"</span>].<span class="bu">str</span>.zfill(<span class="dv">2</span>) <span class="op">+</span> df_main[<span class="st">"county_fips"</span>].<span class="bu">str</span>.zfill(<span class="dv">3</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co"># === Education variables from ACS B15003 ===</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>variables <span class="op">=</span> [</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NAME"</span>,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B15003_001E"</span>,  <span class="co"># Total population 25+</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B15003_017E"</span>,  <span class="co"># High school graduate</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B15003_022E"</span>,  <span class="co"># Bachelor's degree</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B15003_025E"</span>   <span class="co"># Graduate/professional degree</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>base_url <span class="op">=</span> <span class="st">"https://api.census.gov/data/2022/acs/acs5"</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>state_fips <span class="op">=</span> [<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">:02d}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">57</span>) <span class="cf">if</span> i <span class="kw">not</span> <span class="kw">in</span> {<span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">14</span>, <span class="dv">43</span>, <span class="dv">52</span>}]</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="co"># === Robust request function with retries ===</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fetch_with_retries(url, params, max_retries<span class="op">=</span><span class="dv">8</span>):</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> attempt <span class="kw">in</span> <span class="bu">range</span>(max_retries):</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> requests.get(url, params<span class="op">=</span>params, timeout<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> response</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"  Request failed with status </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">, retrying in </span><span class="sc">{</span><span class="dv">2</span> <span class="op">**</span> attempt<span class="sc">}</span><span class="ss"> seconds..."</span>)</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> requests.exceptions.RequestException <span class="im">as</span> e:</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">, retrying in </span><span class="sc">{</span><span class="dv">2</span> <span class="op">**</span> attempt<span class="sc">}</span><span class="ss"> seconds..."</span>)</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">2</span> <span class="op">**</span> attempt)</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  Max retries exceeded. Skipping this state."</span>)</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a><span class="co"># === Begin pulling ===</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Starting education data fetch from Census API..."</span>)</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> fips <span class="kw">in</span> state_fips:</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"🔍 Querying counties in state FIPS </span><span class="sc">{</span>fips<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">"get"</span>: <span class="st">","</span>.join(variables),</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">"for"</span>: <span class="st">"county:*"</span>,</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>        <span class="st">"in"</span>: <span class="ss">f"state:</span><span class="sc">{</span>fips<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> fetch_with_retries(base_url, params<span class="op">=</span>params)</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> response:</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>            rows <span class="op">=</span> response.json()</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>            headers <span class="op">=</span> rows[<span class="dv">0</span>]</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> rows[<span class="dv">1</span>:]</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.DataFrame(data, columns<span class="op">=</span>headers)</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">"state"</span>] <span class="op">=</span> fips</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">"fips_code"</span>] <span class="op">=</span> df[<span class="st">"state"</span>].<span class="bu">str</span>.zfill(<span class="dv">2</span>) <span class="op">+</span> df[<span class="st">"county"</span>].<span class="bu">str</span>.zfill(<span class="dv">3</span>)</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>            all_data.append(df)</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Retrieved </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">}</span><span class="ss"> records."</span>)</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  Failed to parse response for state </span><span class="sc">{</span>fips<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">2</span>)</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a><span class="co"># === Combine data ===</span></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>edu_df <span class="op">=</span> pd.concat(all_data, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total counties pulled: </span><span class="sc">{</span><span class="bu">len</span>(edu_df)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a><span class="co"># === Convert columns ===</span></span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"B15003_001E"</span>, <span class="st">"B15003_017E"</span>, <span class="st">"B15003_022E"</span>, <span class="st">"B15003_025E"</span>]:</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>    edu_df[col] <span class="op">=</span> pd.to_numeric(edu_df[col], errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a><span class="co"># === Compute percentages ===</span></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>edu_df[<span class="st">"pct_hs_or_higher"</span>] <span class="op">=</span> (</span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>    (edu_df[<span class="st">"B15003_017E"</span>] <span class="op">+</span> edu_df[<span class="st">"B15003_022E"</span>] <span class="op">+</span> edu_df[<span class="st">"B15003_025E"</span>]) <span class="op">/</span> edu_df[<span class="st">"B15003_001E"</span>]</span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>edu_df[<span class="st">"pct_ba_or_higher"</span>] <span class="op">=</span> (</span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>    (edu_df[<span class="st">"B15003_022E"</span>] <span class="op">+</span> edu_df[<span class="st">"B15003_025E"</span>]) <span class="op">/</span> edu_df[<span class="st">"B15003_001E"</span>]</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a><span class="co"># === Trim and merge ===</span></span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>edu_df <span class="op">=</span> edu_df[[<span class="st">"fips_code"</span>, <span class="st">"pct_hs_or_higher"</span>, <span class="st">"pct_ba_or_higher"</span>]]</span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>df_merged <span class="op">=</span> pd.merge(df_main, edu_df, on<span class="op">=</span><span class="st">"fips_code"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a><span class="co"># === Save ===</span></span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>df_merged.to_csv(edu_output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Updated dataset with education variables saved to: </span><span class="sc">{</span>edu_output_path<span class="sc">.</span>resolve()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>📡 Starting education data fetch from Census API...
🔍 Querying counties in state FIPS 01...
  ✅ Retrieved 67 records.
🔍 Querying counties in state FIPS 02...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 1 seconds...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 2 seconds...
  ✅ Retrieved 30 records.
🔍 Querying counties in state FIPS 04...
  ✅ Retrieved 15 records.
🔍 Querying counties in state FIPS 05...
  ✅ Retrieved 75 records.
🔍 Querying counties in state FIPS 06...
  ✅ Retrieved 58 records.
🔍 Querying counties in state FIPS 08...
  ✅ Retrieved 64 records.
🔍 Querying counties in state FIPS 09...
  ✅ Retrieved 9 records.
🔍 Querying counties in state FIPS 10...
  ✅ Retrieved 3 records.
🔍 Querying counties in state FIPS 11...
  ✅ Retrieved 1 records.
🔍 Querying counties in state FIPS 12...
  ✅ Retrieved 67 records.
🔍 Querying counties in state FIPS 13...
  ✅ Retrieved 159 records.
🔍 Querying counties in state FIPS 15...
  ✅ Retrieved 5 records.
🔍 Querying counties in state FIPS 16...
  ✅ Retrieved 44 records.
🔍 Querying counties in state FIPS 17...
  ✅ Retrieved 102 records.
🔍 Querying counties in state FIPS 18...
  ✅ Retrieved 92 records.
🔍 Querying counties in state FIPS 19...
  ✅ Retrieved 99 records.
🔍 Querying counties in state FIPS 20...
  ✅ Retrieved 105 records.
🔍 Querying counties in state FIPS 21...
  ✅ Retrieved 120 records.
🔍 Querying counties in state FIPS 22...
  ✅ Retrieved 64 records.
🔍 Querying counties in state FIPS 23...
  ✅ Retrieved 16 records.
🔍 Querying counties in state FIPS 24...
  ✅ Retrieved 24 records.
🔍 Querying counties in state FIPS 25...
  ✅ Retrieved 14 records.
🔍 Querying counties in state FIPS 26...
  ✅ Retrieved 83 records.
🔍 Querying counties in state FIPS 27...
  ✅ Retrieved 87 records.
🔍 Querying counties in state FIPS 28...
  ✅ Retrieved 82 records.
🔍 Querying counties in state FIPS 29...
  ✅ Retrieved 115 records.
🔍 Querying counties in state FIPS 30...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 1 seconds...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 2 seconds...
  ✅ Retrieved 56 records.
🔍 Querying counties in state FIPS 31...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 1 seconds...
  ✅ Retrieved 93 records.
🔍 Querying counties in state FIPS 32...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 1 seconds...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 2 seconds...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 4 seconds...
  ✅ Retrieved 17 records.
🔍 Querying counties in state FIPS 33...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 1 seconds...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 2 seconds...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 4 seconds...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 8 seconds...
  ✅ Retrieved 10 records.
🔍 Querying counties in state FIPS 34...
  ✅ Retrieved 21 records.
🔍 Querying counties in state FIPS 35...
  ✅ Retrieved 33 records.
🔍 Querying counties in state FIPS 36...
  Request failed with status 503, retrying in 1 seconds...
  ✅ Retrieved 62 records.
🔍 Querying counties in state FIPS 37...
  ✅ Retrieved 100 records.
🔍 Querying counties in state FIPS 38...
  ✅ Retrieved 53 records.
🔍 Querying counties in state FIPS 39...
  ✅ Retrieved 88 records.
🔍 Querying counties in state FIPS 40...
  ✅ Retrieved 77 records.
🔍 Querying counties in state FIPS 41...
  ✅ Retrieved 36 records.
🔍 Querying counties in state FIPS 42...
  ✅ Retrieved 67 records.
🔍 Querying counties in state FIPS 44...
  ✅ Retrieved 5 records.
🔍 Querying counties in state FIPS 45...
  ✅ Retrieved 46 records.
🔍 Querying counties in state FIPS 46...
  ✅ Retrieved 66 records.
🔍 Querying counties in state FIPS 47...
  ✅ Retrieved 95 records.
🔍 Querying counties in state FIPS 48...
  ✅ Retrieved 254 records.
🔍 Querying counties in state FIPS 49...
  ✅ Retrieved 29 records.
🔍 Querying counties in state FIPS 50...
  ✅ Retrieved 14 records.
🔍 Querying counties in state FIPS 51...
  ✅ Retrieved 133 records.
🔍 Querying counties in state FIPS 53...
  ✅ Retrieved 39 records.
🔍 Querying counties in state FIPS 54...
  ✅ Retrieved 55 records.
🔍 Querying counties in state FIPS 55...
  ✅ Retrieved 72 records.
🔍 Querying counties in state FIPS 56...
  ✅ Retrieved 23 records.
✅ Total counties pulled: 3144
✅ Updated dataset with education variables saved to: /home/platinumfish/Desktop/Coding_projects/data_visualization_project_2025/data/merged_broadband_full.csv</code></pre>
</div>
</div>
</section>
<section id="gather-acs-5-year-racial-identity-data" class="level3">
<h3 class="anchored" data-anchor-id="gather-acs-5-year-racial-identity-data">Gather ACS-5 Year Racial Identity Data</h3>
<div id="cell-15" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === File paths ===</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>acs_path <span class="op">=</span> Path(<span class="st">"../data/merged_broadband_full.csv"</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> Path(<span class="st">"../data/merged_broadband_full.csv"</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># === Load existing dataset ===</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>df_main <span class="op">=</span> pd.read_csv(acs_path, dtype<span class="op">=</span>{<span class="st">"state_fips"</span>: <span class="bu">str</span>, <span class="st">"county_fips"</span>: <span class="bu">str</span>})</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>df_main[<span class="st">"fips_code"</span>] <span class="op">=</span> df_main[<span class="st">"state_fips"</span>].<span class="bu">str</span>.zfill(<span class="dv">2</span>) <span class="op">+</span> df_main[<span class="st">"county_fips"</span>].<span class="bu">str</span>.zfill(<span class="dv">3</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># === Census variables to pull ===</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>variables <span class="op">=</span> [</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NAME"</span>,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B02001_001E"</span>,  <span class="co"># Total population</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B02001_002E"</span>,  <span class="co"># White alone</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B02001_003E"</span>,  <span class="co"># Black or African American alone</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B02001_004E"</span>,  <span class="co"># American Indian and Alaska Native alone</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B02001_005E"</span>,  <span class="co"># Asian alone</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B02001_007E"</span>,  <span class="co"># Some other race alone</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B02001_008E"</span>,  <span class="co"># Two or more races</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B03003_003E"</span>   <span class="co"># Hispanic or Latino</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>base_url <span class="op">=</span> <span class="st">"https://api.census.gov/data/2022/acs/acs5"</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>state_fips <span class="op">=</span> [<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">:02d}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">57</span>) <span class="cf">if</span> i <span class="kw">not</span> <span class="kw">in</span> {<span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">14</span>, <span class="dv">43</span>, <span class="dv">52</span>}]</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>all_data <span class="op">=</span> []</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="co"># === Retryable fetch ===</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fetch_with_retries(url, params, max_retries<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> attempt <span class="kw">in</span> <span class="bu">range</span>(max_retries):</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> requests.get(url, params<span class="op">=</span>params, timeout<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> response</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  Request failed with status </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">, retrying..."</span>)</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> requests.exceptions.RequestException <span class="im">as</span> e:</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">, retrying in </span><span class="sc">{</span><span class="dv">2</span> <span class="op">**</span> attempt<span class="sc">}</span><span class="ss"> seconds..."</span>)</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="dv">2</span> <span class="op">**</span> attempt)</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  Max retries exceeded. Skipping this state."</span>)</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a><span class="co"># === Begin pull ===</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Starting detailed race and ethnicity data pull..."</span>)</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> fips <span class="kw">in</span> state_fips:</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Querying counties in state FIPS </span><span class="sc">{</span>fips<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">"get"</span>: <span class="st">","</span>.join(variables),</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">"for"</span>: <span class="st">"county:*"</span>,</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>        <span class="st">"in"</span>: <span class="ss">f"state:</span><span class="sc">{</span>fips<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> fetch_with_retries(base_url, params<span class="op">=</span>params)</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> response:</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>            rows <span class="op">=</span> response.json()</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>            headers <span class="op">=</span> rows[<span class="dv">0</span>]</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> rows[<span class="dv">1</span>:]</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.DataFrame(data, columns<span class="op">=</span>headers)</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">"state"</span>] <span class="op">=</span> fips</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">"fips_code"</span>] <span class="op">=</span> df[<span class="st">"state"</span>].<span class="bu">str</span>.zfill(<span class="dv">2</span>) <span class="op">+</span> df[<span class="st">"county"</span>].<span class="bu">str</span>.zfill(<span class="dv">3</span>)</span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>            all_data.append(df)</span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  Retrieved </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">}</span><span class="ss"> records."</span>)</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  Failed to parse response for state </span><span class="sc">{</span>fips<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">2</span>)</span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a><span class="co"># === Combine and convert ===</span></span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>race_df <span class="op">=</span> pd.concat(all_data, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total counties pulled: </span><span class="sc">{</span><span class="bu">len</span>(race_df)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert numeric columns</span></span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [</span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B02001_001E"</span>, <span class="st">"B02001_002E"</span>, <span class="st">"B02001_003E"</span>,</span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B02001_004E"</span>, <span class="st">"B02001_005E"</span>, <span class="st">"B02001_007E"</span>,</span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B02001_008E"</span>, <span class="st">"B03003_003E"</span></span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>race_df[cols] <span class="op">=</span> race_df[cols].<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a><span class="co"># === Calculate percent composition ===</span></span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a>race_df[<span class="st">"percent_white_alone"</span>] <span class="op">=</span> (race_df[<span class="st">"B02001_002E"</span>] <span class="op">/</span> race_df[<span class="st">"B02001_001E"</span>]).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a>race_df[<span class="st">"percent_black_alone"</span>] <span class="op">=</span> (race_df[<span class="st">"B02001_003E"</span>] <span class="op">/</span> race_df[<span class="st">"B02001_001E"</span>]).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a>race_df[<span class="st">"percent_native_american_alone"</span>] <span class="op">=</span> (race_df[<span class="st">"B02001_004E"</span>] <span class="op">/</span> race_df[<span class="st">"B02001_001E"</span>]).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a>race_df[<span class="st">"percent_asian_alone"</span>] <span class="op">=</span> (race_df[<span class="st">"B02001_005E"</span>] <span class="op">/</span> race_df[<span class="st">"B02001_001E"</span>]).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a>race_df[<span class="st">"percent_other_race_alone"</span>] <span class="op">=</span> (race_df[<span class="st">"B02001_007E"</span>] <span class="op">/</span> race_df[<span class="st">"B02001_001E"</span>]).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a>race_df[<span class="st">"percent_two_or_more_races"</span>] <span class="op">=</span> (race_df[<span class="st">"B02001_008E"</span>] <span class="op">/</span> race_df[<span class="st">"B02001_001E"</span>]).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a>race_df[<span class="st">"percent_hispanic_latino"</span>] <span class="op">=</span> (race_df[<span class="st">"B03003_003E"</span>] <span class="op">/</span> race_df[<span class="st">"B02001_001E"</span>]).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only relevant columns</span></span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a>race_df <span class="op">=</span> race_df[[</span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fips_code"</span>,</span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a>    <span class="st">"percent_white_alone"</span>,</span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a>    <span class="st">"percent_black_alone"</span>,</span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a>    <span class="st">"percent_native_american_alone"</span>,</span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a>    <span class="st">"percent_asian_alone"</span>,</span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true" tabindex="-1"></a>    <span class="st">"percent_other_race_alone"</span>,</span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true" tabindex="-1"></a>    <span class="st">"percent_two_or_more_races"</span>,</span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a>    <span class="st">"percent_hispanic_latino"</span></span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true" tabindex="-1"></a>]]</span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true" tabindex="-1"></a><span class="co"># === Merge and save ===</span></span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true" tabindex="-1"></a>df_merged <span class="op">=</span> pd.merge(df_main, race_df, on<span class="op">=</span><span class="st">"fips_code"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true" tabindex="-1"></a>df_merged.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb15-106"><a href="#cb15-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-107"><a href="#cb15-107" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Updated dataset with detailed race and ethnicity variables saved to: </span><span class="sc">{</span>output_path<span class="sc">.</span>resolve()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Starting detailed race and ethnicity data pull...
Querying counties in state FIPS 01...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 1 seconds...
  Request failed with status 503, retrying...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 4 seconds...
  Retrieved 67 records.
Querying counties in state FIPS 02...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 1 seconds...
  Retrieved 30 records.
Querying counties in state FIPS 04...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 1 seconds...
  Retrieved 15 records.
Querying counties in state FIPS 05...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 1 seconds...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 2 seconds...
  Retrieved 75 records.
Querying counties in state FIPS 06...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 1 seconds...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 2 seconds...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 4 seconds...
  Retrieved 58 records.
Querying counties in state FIPS 08...
  Retrieved 64 records.
Querying counties in state FIPS 09...
  Retrieved 9 records.
Querying counties in state FIPS 10...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 1 seconds...
  Retrieved 3 records.
Querying counties in state FIPS 11...
  Retrieved 1 records.
Querying counties in state FIPS 12...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Max retries exceeded with url: /data/2022/acs/acs5?get=NAME%2CB02001_001E%2CB02001_002E%2CB02001_003E%2CB02001_004E%2CB02001_005E%2CB02001_007E%2CB02001_008E%2CB03003_003E&amp;for=county%3A%2A&amp;in=state%3A12 (Caused by NewConnectionError('&lt;urllib3.connection.HTTPSConnection object at 0x7c3ed0accd40&gt;: Failed to establish a new connection: [Errno 101] Network is unreachable')), retrying in 1 seconds...
  Retrieved 67 records.
Querying counties in state FIPS 13...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 1 seconds...
  Retrieved 159 records.
Querying counties in state FIPS 15...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 1 seconds...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 2 seconds...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 4 seconds...
  Retrieved 5 records.
Querying counties in state FIPS 16...
  Retrieved 44 records.
Querying counties in state FIPS 17...
  Retrieved 102 records.
Querying counties in state FIPS 18...
  Retrieved 92 records.
Querying counties in state FIPS 19...
  Retrieved 99 records.
Querying counties in state FIPS 20...
  Retrieved 105 records.
Querying counties in state FIPS 21...
  Retrieved 120 records.
Querying counties in state FIPS 22...
  Retrieved 64 records.
Querying counties in state FIPS 23...
  Retrieved 16 records.
Querying counties in state FIPS 24...
  Retrieved 24 records.
Querying counties in state FIPS 25...
  Retrieved 14 records.
Querying counties in state FIPS 26...
  Retrieved 83 records.
Querying counties in state FIPS 27...
  Retrieved 87 records.
Querying counties in state FIPS 28...
  Retrieved 82 records.
Querying counties in state FIPS 29...
  Retrieved 115 records.
Querying counties in state FIPS 30...
  Retrieved 56 records.
Querying counties in state FIPS 31...
  Retrieved 93 records.
Querying counties in state FIPS 32...
  Retrieved 17 records.
Querying counties in state FIPS 33...
  Retrieved 10 records.
Querying counties in state FIPS 34...
  Retrieved 21 records.
Querying counties in state FIPS 35...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 1 seconds...
  Retrieved 33 records.
Querying counties in state FIPS 36...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 1 seconds...
  Retrieved 62 records.
Querying counties in state FIPS 37...
  Retrieved 100 records.
Querying counties in state FIPS 38...
  Retrieved 53 records.
Querying counties in state FIPS 39...
  Retrieved 88 records.
Querying counties in state FIPS 40...
  Retrieved 77 records.
Querying counties in state FIPS 41...
  Request failed with status 503, retrying...
  Request failed with status 503, retrying...
  Retrieved 36 records.
Querying counties in state FIPS 42...
  Retrieved 67 records.
Querying counties in state FIPS 44...
  Retrieved 5 records.
Querying counties in state FIPS 45...
  Request failed with status 503, retrying...
  Retrieved 46 records.
Querying counties in state FIPS 46...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 1 seconds...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 2 seconds...
  Retrieved 66 records.
Querying counties in state FIPS 47...
  Request failed with status 503, retrying...
  Retrieved 95 records.
Querying counties in state FIPS 48...
  Request failed with status 503, retrying...
  Retrieved 254 records.
Querying counties in state FIPS 49...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 1 seconds...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 2 seconds...
  Request failed with status 503, retrying...
  Request failed with status 503, retrying...
  Retrieved 29 records.
Querying counties in state FIPS 50...
  Retrieved 14 records.
Querying counties in state FIPS 51...
  Retrieved 133 records.
Querying counties in state FIPS 53...
  Retrieved 39 records.
Querying counties in state FIPS 54...
  Retrieved 55 records.
Querying counties in state FIPS 55...
  Error: HTTPSConnectionPool(host='api.census.gov', port=443): Read timed out. (read timeout=10), retrying in 1 seconds...
  Retrieved 72 records.
Querying counties in state FIPS 56...
  Retrieved 23 records.
Total counties pulled: 3144
Updated dataset with detailed race and ethnicity variables saved to: /home/platinumfish/Desktop/Coding_projects/data_visualization_project_2025/data/merged_broadband_full.csv</code></pre>
</div>
</div>
</section>
<section id="remove-the-alaskan-aleutian-islands-to-prevent-visualization-issues-also-include-geographic-data-for-graphing" class="level3">
<h3 class="anchored" data-anchor-id="remove-the-alaskan-aleutian-islands-to-prevent-visualization-issues-also-include-geographic-data-for-graphing">Remove the Alaskan Aleutian Islands to Prevent Visualization Issues, also Include Geographic Data for Graphing</h3>
<div id="cell-17" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># === File paths ===</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>csv_path <span class="op">=</span> Path(<span class="st">"../data/merged_broadband_full.csv"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>shp_path <span class="op">=</span> Path(<span class="st">"../data/cb_2023_us_county_500k/cb_2023_us_county_500k.shp"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># === Load broadband dataset ===</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Loading broadband dataset..."</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(csv_path, dtype<span class="op">=</span>{<span class="st">"state_fips"</span>: <span class="bu">str</span>, <span class="st">"county_fips"</span>: <span class="bu">str</span>})</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"fips_code"</span>] <span class="op">=</span> df[<span class="st">"state_fips"</span>].<span class="bu">str</span>.zfill(<span class="dv">2</span>) <span class="op">+</span> df[<span class="st">"county_fips"</span>].<span class="bu">str</span>.zfill(<span class="dv">3</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Loaded </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">}</span><span class="ss"> broadband records"</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># === Load shapefile ===</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Loading county shapefile..."</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.read_file(shp_path)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>gdf[<span class="st">"fips_code"</span>] <span class="op">=</span> gdf[<span class="st">"STATEFP"</span>] <span class="op">+</span> gdf[<span class="st">"COUNTYFP"</span>]</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Loaded </span><span class="sc">{</span><span class="bu">len</span>(gdf)<span class="sc">}</span><span class="ss"> geometries"</span>)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co"># === Merge datasets ===</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Merging broadband data with geometries..."</span>)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>merged_gdf <span class="op">=</span> gdf.merge(df, on<span class="op">=</span><span class="st">"fips_code"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Merged shape: </span><span class="sc">{</span>merged_gdf<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="co"># === Remove Aleutians ===</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Removing Aleutian Islands (FIPS 02013, 02016)..."</span>)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>merged_gdf <span class="op">=</span> merged_gdf[<span class="op">~</span>merged_gdf[<span class="st">"fips_code"</span>].isin([<span class="st">"02013"</span>, <span class="st">"02016"</span>])]</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final shape after filter: </span><span class="sc">{</span>merged_gdf<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co"># === Save updated CSV ===</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>output_csv_path <span class="op">=</span> Path(<span class="st">"../data/merged_broadband_full.csv"</span>)</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>merged_gdf.drop(columns<span class="op">=</span><span class="st">"geometry"</span>).to_csv(output_csv_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Updated dataset saved to: </span><span class="sc">{</span>output_csv_path<span class="sc">.</span>resolve()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Loading broadband dataset...
  Loaded 3144 broadband records
Loading county shapefile...
  Loaded 3235 geometries
Merging broadband data with geometries...
  Merged shape: (3235, 46)
Removing Aleutian Islands (FIPS 02013, 02016)...
Final shape after filter: (3233, 46)
Updated dataset saved to: /home/platinumfish/Desktop/Coding_projects/data_visualization_project_2025/data/merged_broadband_full.csv</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>